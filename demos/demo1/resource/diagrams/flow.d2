title: |md
  # Code Analysis and Transformation Flow
| {near: top-center}

user_code: User Code {
  shape: document
  style.multiple: true
}

decorator: "@task Decorator" {
  shape: hexagon
}

metaclass: Task Metaclass {
  shape: hexagon

  registry: Class Level\nTask Registry
  metadata: Metadata Extraction
}

analyzer: Task Analyzer {
  shape: rectangle

  ast: AST Analysis
  type_info: Type Information
  deps: Dependency Analysis
}

code_gen: Code Generator {
  shape: rectangle

  template: Template Engine
  worker_code: Worker Code
}

execution: Execution {
  shape: rectangle

  thread: Thread Executor
  docker: Docker Executor
}

user_code -> decorator: Decoration
decorator -> metaclass: Class Creation

metaclass.registry -> analyzer: Task Info
metaclass.metadata -> analyzer: Type Info
analyzer.ast -> code_gen.template: Code Structure
analyzer.type_info -> code_gen.template: Type Safety
code_gen.worker_code -> execution: Generated Code

style: {
  fill: "#f0f0f0"
  stroke: "#2d2d2d"
  stroke-width: 2
  font-size: 12
}
